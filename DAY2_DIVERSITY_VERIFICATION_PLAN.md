# Day 2 Diversity Penalty ê²€ì¦ ê³„íš

## ğŸ“‹ ë°°ê²½

Phase 3 Day 2 ì‘ì—… ì¤‘ **ì˜ˆìƒ ì™¸ë¡œ Diversity Penaltyê°€ ì „ì²´ íŒŒì´í”„ë¼ì¸ì— ì™„ì „íˆ í†µí•©**ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤.

- âœ… Rerankerì— diversity_penalty ë¡œì§ êµ¬í˜„ ì™„ë£Œ
- âœ… VectorStoreì— diversity_penalty ì „ë‹¬ ì™„ë£Œ
- âœ… app.py, desktop_app.pyì— íŒŒë¼ë¯¸í„° ì¶”ê°€ ì™„ë£Œ
- âš ï¸ í•˜ì§€ë§Œ **68ê°œ í…ŒìŠ¤íŠ¸ë¡œ ì‹¤ì œ íš¨ê³¼ ê²€ì¦ì€ ì•„ì§ ë¯¸ì™„ë£Œ**

**ëª©í‘œ**: Day 2 ì™„ë£Œ ë³´ê³ ì„œì—ì„œ ì˜ˆìƒí–ˆë˜ ë‹¤ì–‘ì„± ê°œì„  íš¨ê³¼ê°€ ì‹¤ì œë¡œ ë‚˜íƒ€ë‚˜ëŠ”ì§€ ê²€ì¦

---

## ğŸ¯ ê²€ì¦ ëª©í‘œ

### Day 2 ì™„ë£Œ ë³´ê³ ì„œ ì˜ˆìƒ ëª©í‘œ (DAY2_COMPLETION_REPORT.md)

| ì§€í‘œ | Before | Target | ë³´ìˆ˜ì  ì˜ˆìƒ | ë‚™ê´€ì  ì˜ˆìƒ |
|------|--------|--------|-------------|-------------|
| **ê³ ìœ  ë¬¸ì„œ ìˆ˜** | 1.0 | 3.5 | 2.5 | 4.0 |
| **ë‹¤ì–‘ì„± ë¹„ìœ¨** | 0.23 | 0.70 | 0.50 | 0.75 |
| **ë‹¤ì¤‘ ë¬¸ì„œ í…ŒìŠ¤íŠ¸** | 0% | 85% | 60% | 90% |
| **ë¬¸ì„œ ì í•©ì„±** | 50.9 | 75.0 | 65.0 | 80.0 |
| **ë‹µë³€ ì™„ì „ì„±** | 77.4 | 77.4 | 75.0 | 80.0 |
| **ì „ì²´ ì ìˆ˜** | 73.1 | 85.0 | 78.0 | 87.0 |

**ê²€ì¦ ëª©í‘œ**:
1. âœ… **ê³ ìœ  ë¬¸ì„œ ìˆ˜ â‰¥ 2.5** (ë³´ìˆ˜ì  ëª©í‘œ)
2. âœ… **ë‹¤ì–‘ì„± ë¹„ìœ¨ â‰¥ 50%** (ë³´ìˆ˜ì  ëª©í‘œ)
3. âœ… **ë‹¤ì¤‘ ë¬¸ì„œ í…ŒìŠ¤íŠ¸ â‰¥ 60%** (ë³´ìˆ˜ì  ëª©í‘œ)
4. âš ï¸ **ë‹µë³€ í’ˆì§ˆ íšŒê·€ ì—†ìŒ** (â‰¥ 75/100 ìœ ì§€)

---

## ğŸ“… ì‹¤í–‰ ê³„íš (ì´ 3ì‹œê°„)

### Phase 1: í…ŒìŠ¤íŠ¸ í™˜ê²½ ì¤€ë¹„ (30ë¶„)

#### 1.1 Config íŒŒì¼ í™•ì¸
**íŒŒì¼**: config_test.json

**í•„ìˆ˜ ì„¤ì •**:
```json
{
  "diversity_penalty": 0.3,
  "diversity_source_key": "source",
  "use_reranker": true,
  "reranker_model": "multilingual-mini"
}
```

**ê²€ì¦ í•­ëª©**:
- [x] diversity_penaltyê°€ 0.3ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ”ê°€?
- [x] use_rerankerê°€ trueì¸ê°€?
- [x] LLM ì„¤ì •ì´ ì˜¬ë°”ë¥¸ê°€? (gpt-4o-mini ê¶Œì¥)

#### 1.2 í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ í™•ì¸
**íŒŒì¼**: run_comprehensive_test_real.py

**ê²€ì¦ í•­ëª©**:
- [x] diversity_penaltyë¥¼ RAGChainì— ì „ë‹¬í•˜ëŠ”ê°€?
- [x] 68ê°œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ íŒŒì¼ ì¡´ì¬í•˜ëŠ”ê°€?
  - test_cases_comprehensive_v2.json (46ê°œ)
  - test_cases_balanced.json (22ê°œ)

#### 1.3 ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸ í™•ì¸
**íŒŒì¼**: analyze_diversity_results.py (Day 2ì—ì„œ ìƒì„±ë¨)

**ê²€ì¦ í•­ëª©**:
- [x] íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ”ê°€?
- [x] ê³ ìœ  ë¬¸ì„œ ìˆ˜, ë‹¤ì–‘ì„± ë¹„ìœ¨ ê³„ì‚° ë¡œì§ì´ ìˆëŠ”ê°€?

---

### Phase 2: 68ê°œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (1.5ì‹œê°„)

#### 2.1 Comprehensive Test (46ê°œ)
```bash
python run_comprehensive_test_real.py \
  --test-cases test_cases_comprehensive_v2.json \
  --config config_test.json \
  --output-dir test_logs_diversity_day2_comprehensive \
  --summary test_summary_diversity_day2_comprehensive.json
```

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: ì•½ 60-90ë¶„
**ì˜ˆìƒ ê²°ê³¼**: 46ê°œ í…ŒìŠ¤íŠ¸ ì„±ê³µ, diversity_penalty ì ìš© í™•ì¸

#### 2.2 Balanced Test (22ê°œ)
```bash
python run_comprehensive_test_real.py \
  --test-cases test_cases_balanced.json \
  --config config_test.json \
  --output-dir test_logs_diversity_day2_balanced \
  --summary test_summary_diversity_day2_balanced.json
```

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: ì•½ 30-40ë¶„
**ì˜ˆìƒ ê²°ê³¼**: 22ê°œ í…ŒìŠ¤íŠ¸ ì„±ê³µ

---

### Phase 3: Diversity ë¶„ì„ (30ë¶„)

#### 3.1 Diversity ì§€í‘œ ê³„ì‚°
```bash
python analyze_diversity_results.py \
  --test-logs-dir test_logs_diversity_day2_comprehensive \
  --output diversity_analysis_day2_verified.json
```

**ì¸¡ì • ì§€í‘œ**:
1. **í‰ê·  ê³ ìœ  ë¬¸ì„œ ìˆ˜** (avg_unique_docs)
2. **í‰ê·  Diversity Ratio** (avg_diversity_ratio)
3. **Multi-doc í…ŒìŠ¤íŠ¸ ë¹„ìœ¨** (multi_doc_test_ratio)
4. **ê³ ìœ  ë¬¸ì„œ ìˆ˜ ë¶„í¬** (1ê°œ, 2ê°œ, 3ê°œ, 4ê°œ, 5ê°œ)

#### 3.2 Before/After ë¹„êµ

**Before (Day 1 Baseline)**:
- íŒŒì¼: `diversity_analysis_day1_baseline.json` (ì—†ìœ¼ë©´ ì¶”ì •ê°’ ì‚¬ìš©)
- í‰ê·  ê³ ìœ  ë¬¸ì„œ ìˆ˜: 1.0ê°œ
- ë‹¤ì–‘ì„± ë¹„ìœ¨: 0.23
- Multi-doc ë¹„ìœ¨: 0%

**After (Day 2 with diversity_penalty=0.3)**:
- íŒŒì¼: `diversity_analysis_day2_verified.json`
- í‰ê·  ê³ ìœ  ë¬¸ì„œ ìˆ˜: ? (ëª©í‘œ â‰¥2.5)
- ë‹¤ì–‘ì„± ë¹„ìœ¨: ? (ëª©í‘œ â‰¥50%)
- Multi-doc ë¹„ìœ¨: ? (ëª©í‘œ â‰¥60%)

---

### Phase 4: ê²°ê³¼ ë¶„ì„ ë° ë³´ê³ ì„œ ì‘ì„± (30min)

#### 4.1 ì„±ê³µ ê¸°ì¤€ í‰ê°€

| ì§€í‘œ | ëª©í‘œ (ë³´ìˆ˜ì ) | ì‹¤ì œ | ë‹¬ì„± ì—¬ë¶€ |
|------|--------------|------|-----------|
| í‰ê·  ê³ ìœ  ë¬¸ì„œ ìˆ˜ | â‰¥ 2.5 | ? | ? |
| ë‹¤ì–‘ì„± ë¹„ìœ¨ | â‰¥ 50% | ? | ? |
| Multi-doc ë¹„ìœ¨ | â‰¥ 60% | ? | ? |
| ë‹µë³€ í’ˆì§ˆ íšŒê·€ | â‰¥ 75/100 | ? | ? |

#### 4.2 Day 2 ì™„ë£Œ ë³´ê³ ì„œ ì—…ë°ì´íŠ¸
**íŒŒì¼**: DAY2_COMPLETION_REPORT.md (ê¸°ì¡´ Day 2 ë³´ê³ ì„œ)

**ì¶”ê°€í•  ì„¹ì…˜**:
```markdown
## ğŸ“Š Diversity Penalty ê²€ì¦ ê²°ê³¼ (2025-11-12)

### ì‹¤ì œ í…ŒìŠ¤íŠ¸ ê²°ê³¼
- í‰ê·  ê³ ìœ  ë¬¸ì„œ ìˆ˜: X.XX (ëª©í‘œ: 2.5)
- ë‹¤ì–‘ì„± ë¹„ìœ¨: XX.X% (ëª©í‘œ: 50%)
- Multi-doc ë¹„ìœ¨: XX.X% (ëª©í‘œ: 60%)

### ëª©í‘œ ë‹¬ì„± í˜„í™©
- [x/â—‹] ë³´ìˆ˜ì  ëª©í‘œ ë‹¬ì„±
- [x/â—‹] ì •ìƒ ëª©í‘œ ë‹¬ì„±
- [x/â—‹] ë‹µë³€ í’ˆì§ˆ ìœ ì§€

### ë¶„ì„ ë° ê¶Œì¥ì‚¬í•­
...
```

#### 4.3 ìƒˆ ë³´ê³ ì„œ ìƒì„± (ì˜µì…˜)
**íŒŒì¼**: DAY2_DIVERSITY_VERIFICATION_REPORT.md

**ë‚´ìš©**:
1. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼
2. Diversity ì§€í‘œ ë¶„ì„
3. Before/After ë¹„êµ
4. ëª©í‘œ ë‹¬ì„± ì—¬ë¶€
5. ê°œì„  ì œì•ˆ

---

## ğŸ”§ ë¦¬ìŠ¤í¬ ê´€ë¦¬

### Risk 1: LLM API ì˜¤ë¥˜
**ì¦ìƒ**: Ollama ì„œë²„ ì—°ê²° ì‹¤íŒ¨ (Phase 3 í†µí•© í…ŒìŠ¤íŠ¸ì—ì„œ ë°œìƒ)
**í™•ë¥ **: Medium
**ì™„í™”**:
1. Ollama ì„œë²„ ì •ìƒ ì‘ë™ í™•ì¸ (`ollama list`)
2. ëŒ€ì•ˆ: gpt-4o-minië¡œ ì „í™˜ (config_test.json ìˆ˜ì •)
3. Fallback: ì¼ë¶€ í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰ (10ê°œ ìƒ˜í”Œ)

**Mitigation Plan**:
```bash
# Ollama ìƒíƒœ í™•ì¸
ollama list

# ëª¨ë¸ ë¡œë“œ í™•ì¸
curl http://localhost:11434/api/tags

# gpt-4o-minië¡œ ì „í™˜ (config_test.json)
{
  "llm_api_type": "openai",
  "llm_model": "gpt-4o-mini",
  "llm_api_key": "your-api-key"
}
```

---

### Risk 2: í…ŒìŠ¤íŠ¸ ì‹œê°„ ì´ˆê³¼
**ì¦ìƒ**: 68ê°œ í…ŒìŠ¤íŠ¸ê°€ 3ì‹œê°„ ì´ìƒ ì†Œìš”
**í™•ë¥ **: Low-Medium
**ì™„í™”**:
1. ë³‘ë ¬ ì‹¤í–‰ (ê°€ëŠ¥ ì‹œ)
2. ìƒ˜í”Œ í…ŒìŠ¤íŠ¸ (20ê°œ)ë¡œ ì¶•ì†Œ
3. ë¹ ë¥¸ LLM ëª¨ë¸ ì‚¬ìš© (gpt-4o-mini)

**Mitigation Plan**:
```bash
# ìƒ˜í”Œ í…ŒìŠ¤íŠ¸ (20ê°œ)
python run_comprehensive_test_real.py \
  --test-cases test_cases_balanced.json \
  --config config_test.json \
  --max-tests 20
```

---

### Risk 3: Diversity ê°œì„  íš¨ê³¼ ë¯¸ë¯¸
**ì¦ìƒ**: í‰ê·  ê³ ìœ  ë¬¸ì„œ ìˆ˜ < 2.5, ë‹¤ì–‘ì„± ë¹„ìœ¨ < 50%
**í™•ë¥ **: Low (ì´ë¯¸ Day 2ì—ì„œ 88.2% ë‹¬ì„± ë³´ê³ )
**ì™„í™”**:
1. diversity_penalty ê°’ ì¦ê°€ (0.3 â†’ 0.5) ì¬í…ŒìŠ¤íŠ¸
2. ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸ ê²€ì¦ (ë¡œì§ ì˜¤ë¥˜ í™•ì¸)
3. Before ë°ì´í„° ì¬í™•ì¸ (baseline ì •í™•ì„±)

**Mitigation Plan**:
- ê²°ê³¼ ë¶„ì„ í›„ ì¶”ê°€ íŠœë‹ ê³„íš ìˆ˜ë¦½
- Day 2 ì™„ë£Œ ë³´ê³ ì„œì˜ ì˜ˆìƒê°’ê³¼ ë¹„êµ

---

### Risk 4: ë‹µë³€ í’ˆì§ˆ íšŒê·€
**ì¦ìƒ**: ë‹µë³€ ì™„ì „ì„± < 75/100 (ê¸°ì¡´ 77.4ì—ì„œ í•˜ë½)
**í™•ë¥ **: Low
**ì™„í™”**:
1. ìƒ˜í”Œ ë‹µë³€ ìˆ˜ë™ ê²€í† 
2. diversity_penalty ê°’ ê°ì†Œ (0.3 â†’ 0.2)
3. Deep Quality Assessment ì¬ì‹¤í–‰

**Mitigation Plan**:
- í’ˆì§ˆ ì €í•˜ í™•ì¸ ì‹œ diversity_penalty ë¹„í™œì„±í™”
- ì›ì¸ ë¶„ì„ í›„ ì¬ì¡°ì •

---

## ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì‹œì‘ ì „
- [ ] Ollama ì„œë²„ ì •ìƒ ì‘ë™ í™•ì¸
- [ ] config_test.json diversity_penalty=0.3 í™•ì¸
- [ ] 68ê°œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ íŒŒì¼ ì¡´ì¬ í™•ì¸
- [ ] analyze_diversity_results.py ìŠ¤í¬ë¦½íŠ¸ í™•ì¸
- [ ] ë””ìŠ¤í¬ ê³µê°„ ì¶©ë¶„ (í…ŒìŠ¤íŠ¸ ë¡œê·¸ ~500MB ì˜ˆìƒ)

### Phase 1 (í…ŒìŠ¤íŠ¸ í™˜ê²½)
- [ ] config_test.json ê²€ì¦
- [ ] run_comprehensive_test_real.py í™•ì¸
- [ ] diversity_penalty íŒŒë¼ë¯¸í„° ì „ë‹¬ í™•ì¸

### Phase 2 (í…ŒìŠ¤íŠ¸ ì‹¤í–‰)
- [ ] Comprehensive Test (46ê°œ) ì‹¤í–‰
- [ ] Balanced Test (22ê°œ) ì‹¤í–‰
- [ ] ì—ëŸ¬ ì—†ì´ ì™„ë£Œ í™•ì¸

### Phase 3 (ë¶„ì„)
- [ ] Diversity ì§€í‘œ ê³„ì‚°
- [ ] Before/After ë¹„êµ
- [ ] ëª©í‘œ ë‹¬ì„± ì—¬ë¶€ í‰ê°€

### Phase 4 (ë³´ê³ ì„œ)
- [ ] ê²°ê³¼ ë¶„ì„ ì™„ë£Œ
- [ ] Day 2 ë³´ê³ ì„œ ì—…ë°ì´íŠ¸
- [ ] ê²€ì¦ ë³´ê³ ì„œ ì‘ì„± (ì˜µì…˜)

---

## ğŸ¯ ì„±ê³µ ê¸°ì¤€

### í•„ìˆ˜ (MUST)
1. âœ… 68ê°œ í…ŒìŠ¤íŠ¸ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ (Exit Code 0)
2. âœ… diversity_penalty=0.3 ì ìš© í™•ì¸
3. âœ… Diversity ì§€í‘œ ì¸¡ì • ì™„ë£Œ
4. âœ… Day 2 ë³´ê³ ì„œ ì—…ë°ì´íŠ¸

### ê¶Œì¥ (SHOULD)
1. âœ… í‰ê·  ê³ ìœ  ë¬¸ì„œ ìˆ˜ â‰¥ 2.5
2. âœ… ë‹¤ì–‘ì„± ë¹„ìœ¨ â‰¥ 50%
3. âœ… Multi-doc ë¹„ìœ¨ â‰¥ 60%
4. âœ… ë‹µë³€ í’ˆì§ˆ ìœ ì§€ (â‰¥ 75/100)

### ì„ íƒ (COULD)
1. â¸ï¸ ì •ìƒ ëª©í‘œ ë‹¬ì„± (í‰ê·  3.0+, 70%+)
2. â¸ï¸ ìƒì„¸ ë¶„ì„ ë³´ê³ ì„œ ì‘ì„±
3. â¸ï¸ ìƒ˜í”Œ ë‹µë³€ ë¹„êµ (Before/After)

---

## ğŸ“Š ì˜ˆìƒ ê²°ê³¼

### ì‹œë‚˜ë¦¬ì˜¤ 1: ë³´ìˆ˜ì  ëª©í‘œ ë‹¬ì„± (70% í™•ë¥ )
- í‰ê·  ê³ ìœ  ë¬¸ì„œ ìˆ˜: 2.5-3.0
- ë‹¤ì–‘ì„± ë¹„ìœ¨: 50-60%
- Multi-doc ë¹„ìœ¨: 60-80%
- **íŒë‹¨**: Day 2 ì‘ì—… ì„±ê³µ, ì¶”ê°€ íŠœë‹ ë¶ˆí•„ìš”

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì •ìƒ ëª©í‘œ ë‹¬ì„± (20% í™•ë¥ )
- í‰ê·  ê³ ìœ  ë¬¸ì„œ ìˆ˜: 3.0-3.5
- ë‹¤ì–‘ì„± ë¹„ìœ¨: 60-70%
- Multi-doc ë¹„ìœ¨: 80-90%
- **íŒë‹¨**: Day 2 ì‘ì—… ëŒ€ì„±ê³µ, ëª©í‘œ ì´ˆê³¼ ë‹¬ì„±

### ì‹œë‚˜ë¦¬ì˜¤ 3: ëª©í‘œ ë¯¸ë‹¬ (10% í™•ë¥ )
- í‰ê·  ê³ ìœ  ë¬¸ì„œ ìˆ˜: < 2.5
- ë‹¤ì–‘ì„± ë¹„ìœ¨: < 50%
- Multi-doc ë¹„ìœ¨: < 60%
- **íŒë‹¨**: diversity_penalty ê°’ ì¦ê°€ í•„ìš” (0.3 â†’ 0.5)

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„ (Phase 3 Day 3)

Day 2 ê²€ì¦ ì™„ë£Œ í›„:
1. âœ… Regression í…ŒìŠ¤íŠ¸ (68ê°œ ê¸°ì¡´ í…ŒìŠ¤íŠ¸, diversity_penalty=0.0)
2. âœ… ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ (ì‘ë‹µ ì‹œê°„ ë¹„êµ)
3. âœ… Phase 3 ì‚¬ìš©ì ê°€ì´ë“œ ì‘ì„±

---

**ì‘ì„±ì¼**: 2025-11-12
**ì‘ì„±ì**: Claude Code
**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 3ì‹œê°„
**ìš°ì„ ìˆœìœ„**: High (Day 2 ì™„ë£Œ ë³´ê³ ì„œ ê²€ì¦)
