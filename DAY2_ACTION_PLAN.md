# Day 2 ì‹¤í–‰ ê³„íš - ë‹¤ì–‘ì„± íŒ¨ë„í‹° í†µí•© ë° ê²€ì¦

**ë‚ ì§œ**: 2025-11-11
**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 3-4ì‹œê°„
**ëª©í‘œ**: diversity_penaltyë¥¼ RAG ì‹œìŠ¤í…œì— ì™„ì „íˆ í†µí•©í•˜ê³  ì „ì²´ í…ŒìŠ¤íŠ¸ë¡œ ê²€ì¦

---

## ğŸ¯ Day 2 ëª©í‘œ

### ì£¼ìš” ëª©í‘œ
1. âœ… **Config í†µí•©**: diversity_penaltyë¥¼ ì„¤ì • íŒŒì¼ì— ì¶”ê°€
2. âœ… **RAG Chain í†µí•©**: ê²€ìƒ‰ ë‹¨ê³„ì—ì„œ íŒ¨ë„í‹° ì ìš©
3. âœ… **ë¹ ë¥¸ ê²€ì¦**: ìƒ˜í”Œ í…ŒìŠ¤íŠ¸ë¡œ ë™ì‘ í™•ì¸
4. âœ… **ì „ì²´ í…ŒìŠ¤íŠ¸**: 67ê°œ í…ŒìŠ¤íŠ¸ë¡œ ì„±ëŠ¥ ê²€ì¦
5. âœ… **ê²°ê³¼ ë¶„ì„**: ë‹¤ì–‘ì„± ê°œì„  íš¨ê³¼ ì¸¡ì •

### ì„±ê³µ ê¸°ì¤€
- [ ] ê³ ìœ  ë¬¸ì„œ ìˆ˜: 1.0ê°œ â†’ 3.0ê°œ ì´ìƒ (ëª©í‘œ: 3.5ê°œ)
- [ ] ë‹¤ì–‘ì„± ë¹„ìœ¨: 0.23 â†’ 0.60 ì´ìƒ (ëª©í‘œ: 0.70)
- [ ] ë¬¸ì„œ ì í•©ì„±: 50.9/100 â†’ 70/100 ì´ìƒ (ëª©í‘œ: 75/100)
- [ ] ì „ì²´ ì ìˆ˜: 73.1/100 â†’ 80/100 ì´ìƒ (ëª©í‘œ: 85/100)
- [ ] ë‹µë³€ í’ˆì§ˆ íšŒê·€ ì—†ìŒ: ë‹µë³€ ì™„ì „ì„± â‰¥ 75/100 ìœ ì§€

---

## ğŸ“‹ ì‹¤í–‰ ë‹¨ê³„

### Phase 1: Config í†µí•© (30ë¶„)

#### 1.1 config.json ì—…ë°ì´íŠ¸
```json
{
  "retrieval": {
    "diversity_penalty": 0.3,
    "diversity_source_key": "source"
  }
}
```

**ì˜ˆìƒ íš¨ê³¼**:
- ì„¤ì • íŒŒì¼ ì¤‘ì•™í™”ë¡œ ê´€ë¦¬ ìš©ì´
- ì‚¬ìš©ìê°€ ì‰½ê²Œ ì¡°ì • ê°€ëŠ¥

#### 1.2 config.py ìŠ¤í‚¤ë§ˆ ì—…ë°ì´íŠ¸
- `diversity_penalty` í•„ë“œ ì¶”ê°€
- ê¸°ë³¸ê°’: 0.3 (ê¶Œì¥ê°’)
- ê²€ì¦: 0.0-1.0 ë²”ìœ„ ì²´í¬

---

### Phase 2: RAG Chain í†µí•© (1ì‹œê°„)

#### 2.1 ê²€ìƒ‰ ë‹¨ê³„ ìˆ˜ì •
**íŒŒì¼**: `utils/rag_chain.py`

**ìˆ˜ì • ìœ„ì¹˜ ì°¾ê¸°**:
```python
# í˜„ì¬ ì½”ë“œ (ì˜ˆìƒ)
results = self.vectorstore.similarity_search_with_rerank(
    query=question,
    top_k=top_k,
    initial_k=initial_k
)

# ìˆ˜ì • í›„
results = self.vectorstore.similarity_search_with_rerank(
    query=question,
    top_k=top_k,
    initial_k=initial_k,
    diversity_penalty=self.diversity_penalty  # ì¶”ê°€
)
```

#### 2.2 ìƒì„±ìì— íŒŒë¼ë¯¸í„° ì¶”ê°€
```python
def __init__(self, ..., diversity_penalty=0.3):
    self.diversity_penalty = diversity_penalty
```

#### 2.3 ë¡œê¹… ì¶”ê°€
```python
if self.diversity_penalty > 0:
    logger.info(f"[Diversity] penalty={self.diversity_penalty} enabled")
```

**ì˜ˆìƒ íš¨ê³¼**:
- ëª¨ë“  ê²€ìƒ‰ì— ë‹¤ì–‘ì„± íŒ¨ë„í‹° ìë™ ì ìš©
- ë¡œê·¸ë¡œ ë™ì‘ í™•ì¸ ê°€ëŠ¥

---

### Phase 3: ë¹ ë¥¸ ê²€ì¦ (30ë¶„)

#### 3.1 ìƒ˜í”Œ í…ŒìŠ¤íŠ¸ 5ê°œ ì‹¤í–‰
```bash
python test_diversity_penalty.py
```

**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤**:
1. "OLEDì™€ QLEDì˜ ì°¨ì´ì ì€?" (ë¹„êµ ì§ˆë¬¸)
2. "MicroLED ë””ìŠ¤í”Œë ˆì´ì˜ ì¥ì ì€?" (ë‹¨ì¼ ì£¼ì œ)
3. "Display ë¶„ì•¼ ìµœì‹  íŠ¸ë Œë“œëŠ”?" (ê´‘ë²”ìœ„)
4. "ê·¸ë˜í•€ì˜ íŠ¹ì„±ì€?" (êµ¬ì²´ì )
5. "í˜ë¡œë¸ŒìŠ¤ì¹´ì´íŠ¸ íƒœì–‘ì „ì§€ íš¨ìœ¨" (ê¸°ìˆ ì )

**ê²€ì¦ í•­ëª©**:
- [x] ì—ëŸ¬ ì—†ì´ ì‹¤í–‰
- [x] diversity_penalty ë©”íƒ€ë°ì´í„° í™•ì¸
- [x] adjusted_score ì •ìƒ ê³„ì‚°
- [x] ë‹¤ì–‘ì„± ë¹„ìœ¨ ê°œì„  í™•ì¸

---

### Phase 4: ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (1.5ì‹œê°„)

#### 4.1 Comprehensive Test (47ê°œ)
```bash
python run_comprehensive_test_real.py \
  --test-cases test_cases_comprehensive_v2.json \
  --config config_test.json \
  --output-dir test_logs_diversity_enabled \
  --summary test_summary_diversity.json
```

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: ì•½ 60-90ë¶„ (ê° í…ŒìŠ¤íŠ¸ 30-120ì´ˆ)

#### 4.2 Balanced Test (20ê°œ)
```bash
python run_comprehensive_test_real.py \
  --test-cases test_cases_balanced.json \
  --config config_test.json \
  --output-dir test_logs_balanced_diversity \
  --summary test_summary_balanced_diversity.json
```

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: ì•½ 30-40ë¶„

#### 4.3 í…ŒìŠ¤íŠ¸ ì¤‘ ëª¨ë‹ˆí„°ë§
- ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸
- diversity_penalty ì ìš© ì—¬ë¶€ í™•ì¸
- ì—ëŸ¬ ë°œìƒ ì‹œ ì¦‰ì‹œ ëŒ€ì‘

---

### Phase 5: ê²°ê³¼ ë¶„ì„ (1ì‹œê°„)

#### 5.1 Deep Quality Assessment ì‹¤í–‰
```bash
python deep_quality_assessment.py \
  --test-logs-dir test_logs_diversity_enabled \
  --output deep_quality_report_diversity.json
```

#### 5.2 ë¹„êµ ë¶„ì„
**Before (Day 1)**:
- í‰ê·  ê³ ìœ  ë¬¸ì„œ ìˆ˜: 1.0ê°œ
- ë‹¤ì–‘ì„± ë¹„ìœ¨: 0.23
- ë¬¸ì„œ ì í•©ì„±: 50.9/100
- ì „ì²´ ì ìˆ˜: 73.1/100

**After (Day 2 ëª©í‘œ)**:
- í‰ê·  ê³ ìœ  ë¬¸ì„œ ìˆ˜: 3.5ê°œ (+250%)
- ë‹¤ì–‘ì„± ë¹„ìœ¨: 0.70 (+204%)
- ë¬¸ì„œ ì í•©ì„±: 75.0/100 (+24.1)
- ì „ì²´ ì ìˆ˜: 85.0/100 (+11.9)

#### 5.3 í•µì‹¬ ì§€í‘œ ì¶”ì¶œ
```python
# ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸
import json

# Before
before = json.load(open('deep_quality_report_comprehensive.json'))
# After
after = json.load(open('deep_quality_report_diversity.json'))

# ë¹„êµ
print(f"ê³ ìœ  ë¬¸ì„œ ìˆ˜: {before['avg_unique_docs']:.1f} â†’ {after['avg_unique_docs']:.1f}")
print(f"ë‹¤ì–‘ì„± ë¹„ìœ¨: {before['avg_diversity_ratio']:.2f} â†’ {after['avg_diversity_ratio']:.2f}")
print(f"ë¬¸ì„œ ì í•©ì„±: {before['doc_relevance']:.1f} â†’ {after['doc_relevance']:.1f}")
```

---

## ğŸ“Š ì˜ˆìƒ ì„±ê³¼

### ì •ëŸ‰ì  ëª©í‘œ

| ì§€í‘œ | Before | Target | ë³´ìˆ˜ì  ì˜ˆìƒ | ë‚™ê´€ì  ì˜ˆìƒ |
|------|--------|--------|-------------|-------------|
| **ê³ ìœ  ë¬¸ì„œ ìˆ˜** | 1.0 | 3.5 | 2.5 | 4.0 |
| **ë‹¤ì–‘ì„± ë¹„ìœ¨** | 0.23 | 0.70 | 0.50 | 0.75 |
| **ë‹¤ì¤‘ ë¬¸ì„œ í…ŒìŠ¤íŠ¸** | 0% | 85% | 60% | 90% |
| **ë¬¸ì„œ ì í•©ì„±** | 50.9 | 75.0 | 65.0 | 80.0 |
| **ë‹µë³€ ì™„ì „ì„±** | 77.4 | 77.4 | 75.0 | 80.0 |
| **ì „ì²´ ì ìˆ˜** | 73.1 | 85.0 | 78.0 | 87.0 |

### ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ë³´ìˆ˜ì  (70% í™•ë¥ )
- ë‹¤ì–‘ì„±ì€ ê°œì„ ë˜ì§€ë§Œ ëª©í‘œì— ë¯¸ë‹¬
- ê³ ìœ  ë¬¸ì„œ ìˆ˜: 2.5ê°œ (+150%)
- ë¬¸ì„œ ì í•©ì„±: 65/100 (+14.1)
- **íŒë‹¨**: íŒ¨ë„í‹° ê°’ ì¡°ì • í•„ìš” (0.3 â†’ 0.4)

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ëª©í‘œ ë‹¬ì„± (25% í™•ë¥ )
- ì˜ˆìƒëŒ€ë¡œ ëª©í‘œ ë‹¬ì„±
- ê³ ìœ  ë¬¸ì„œ ìˆ˜: 3.5ê°œ (+250%)
- ë¬¸ì„œ ì í•©ì„±: 75/100 (+24.1)
- **íŒë‹¨**: ì„±ê³µ, Week 1 ì™„ë£Œ

#### ì‹œë‚˜ë¦¬ì˜¤ 3: ì´ˆê³¼ ë‹¬ì„± (5% í™•ë¥ )
- ì˜ˆìƒë³´ë‹¤ í° ê°œì„ 
- ê³ ìœ  ë¬¸ì„œ ìˆ˜: 4.0ê°œ ì´ìƒ
- ë¬¸ì„œ ì í•©ì„±: 80/100 ì´ìƒ
- **íŒë‹¨**: íŒ¨ë„í‹° ê°•ë„ í™•ì¸, ê´€ë ¨ì„± ì €í•˜ ì—†ëŠ”ì§€ ì²´í¬

---

## ğŸ”§ ë¦¬ìŠ¤í¬ ë° ì™„í™” ë°©ì•ˆ

### Risk 1: ë‹µë³€ í’ˆì§ˆ ì €í•˜
**ì¦ìƒ**: ë‹µë³€ ì™„ì „ì„± ì ìˆ˜ í•˜ë½ (77.4 â†’ <75)
**ì›ì¸**: ê³¼ë„í•œ ë‹¤ì–‘í™”ë¡œ ê´€ë ¨ì„± ë‚®ì€ ë¬¸ì„œ í¬í•¨
**ì™„í™”**:
- íŒ¨ë„í‹° ê°•ë„ ë‚®ì¶¤ (0.3 â†’ 0.2)
- ë˜ëŠ” ìµœì†Œ ì ìˆ˜ ìƒí–¥ (0.1 â†’ 0.3)

### Risk 2: íŠ¹ì • ì§ˆë¬¸ ìœ í˜• ì„±ëŠ¥ ì €í•˜
**ì¦ìƒ**: ë‹¨ì¼ ë¬¸ì„œ ì§ˆë¬¸ (doc_format_001 ë“±) ì •í™•ë„ í•˜ë½
**ì›ì¸**: íŠ¹ì • íŒŒì¼ ì§ˆë¬¸ì—ë„ ë‹¤ì–‘ì„± ê°•ì œ ì ìš©
**ì™„í™”**:
- Question Classifierì— "specific_document" íƒ€ì… ì¶”ê°€
- í•´ë‹¹ íƒ€ì…ì€ diversity_penalty=0.0 ì‚¬ìš©

### Risk 3: ì„±ëŠ¥ ì €í•˜
**ì¦ìƒ**: í‰ê·  ì‘ë‹µ ì‹œê°„ ì¦ê°€
**ì›ì¸**: ì¬ìˆœìœ„í™” ì˜¤ë²„í—¤ë“œ
**ì™„í™”**:
- ì‹¤ì œë¡œëŠ” O(n) ì˜¤ë²„í—¤ë“œë¡œ ë¬´ì‹œ ê°€ëŠ¥ (< 0.01ì´ˆ)
- ëª¨ë‹ˆí„°ë§ìœ¼ë¡œ í™•ì¸

### Risk 4: ê°œì„  íš¨ê³¼ ë¯¸ë¯¸
**ì¦ìƒ**: ë‹¤ì–‘ì„± ë¹„ìœ¨ 0.30 ë¯¸ë§Œ
**ì›ì¸**: íŒ¨ë„í‹° ê°•ë„ ë¶€ì¡± ë˜ëŠ” DB ìì²´ ë¬¸ì œ
**ì¡°ì¹˜**:
1. íŒ¨ë„í‹° ê°•ë„ ìƒí–¥ (0.3 â†’ 0.5) ì¬í…ŒìŠ¤íŠ¸
2. DB ë¬¸ì„œ ë¶„í¬ í™•ì¸ (íŠ¹ì • ì£¼ì œ ë¬¸ì„œ ë¶€ì¡± ì—¬ë¶€)
3. Retrieval diversity report ì¬ë¶„ì„

---

## ğŸ“ ë¬¸ì„œí™” ê³„íš

### Day 2 ì™„ë£Œ ë³´ê³ ì„œ í¬í•¨ ë‚´ìš©
1. **ì‹¤í–‰ ê²°ê³¼**:
   - ì „/í›„ ë¹„êµí‘œ
   - ê°œì„ ëœ ì§€í‘œ
   - ìƒ˜í”Œ ì¼€ì´ìŠ¤ ë¶„ì„

2. **ë°œê²¬ ì‚¬í•­**:
   - ì˜ˆìƒ ë°–ì˜ ê²°ê³¼
   - ì¶”ê°€ ê°œì„  í•„ìš” ì˜ì—­
   - ë¶€ì‘ìš© ì—¬ë¶€

3. **ê¶Œì¥ì‚¬í•­**:
   - ìµœì  íŒ¨ë„í‹° ê°’
   - íŠ¹ìˆ˜ ì¼€ì´ìŠ¤ ì²˜ë¦¬ ë°©ì•ˆ
   - Phase 2.5 ì—°ê³„ ì‚¬í•­

4. **ë‹¤ìŒ ë‹¨ê³„**:
   - Week 1 ì™„ë£Œ ì—¬ë¶€
   - ì¶”ê°€ ìµœì í™” í•„ìš”ì„±
   - Multi-query ìµœì í™” ì°©ìˆ˜ ì—¬ë¶€

---

## â±ï¸ íƒ€ì„ë¼ì¸

| ì‹œê°„ | ë‹¨ê³„ | ì‘ì—… | ì˜ˆìƒ ì†Œìš” |
|------|------|------|-----------|
| 00:00 | Phase 1 | Config í†µí•© | 30ë¶„ |
| 00:30 | Phase 2 | RAG Chain í†µí•© | 1ì‹œê°„ |
| 01:30 | Phase 3 | ë¹ ë¥¸ ê²€ì¦ | 30ë¶„ |
| 02:00 | Phase 4 | ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ | 1.5ì‹œê°„ |
| 03:30 | Phase 5 | ê²°ê³¼ ë¶„ì„ | 1ì‹œê°„ |
| 04:30 | ì¢…ë£Œ | ë³´ê³ ì„œ ì‘ì„± | 30ë¶„ |
| **05:00** | **ì™„ë£Œ** | **Day 2 ì¢…ë£Œ** | **ì´ 5ì‹œê°„** |

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì‹œì‘ ì „
- [x] Day 1 ì™„ë£Œ í™•ì¸
- [x] Day 2 ê³„íš ìˆ˜ë¦½
- [x] ëª©í‘œ ë° ì„±ê³µ ê¸°ì¤€ ëª…í™•í™”

### Phase 1
- [ ] config.json ì—…ë°ì´íŠ¸
- [ ] config.py ìŠ¤í‚¤ë§ˆ ì¶”ê°€
- [ ] ê¸°ë³¸ê°’ ì„¤ì • í™•ì¸

### Phase 2
- [ ] rag_chain.py ìˆ˜ì •
- [ ] íŒŒë¼ë¯¸í„° ì „ë‹¬ í™•ì¸
- [ ] ë¡œê¹… ì¶”ê°€

### Phase 3
- [ ] ìƒ˜í”Œ í…ŒìŠ¤íŠ¸ 5ê°œ í†µê³¼
- [ ] ë©”íƒ€ë°ì´í„° ì •ìƒ í™•ì¸
- [ ] ë‹¤ì–‘ì„± ê°œì„  í™•ì¸

### Phase 4
- [ ] Comprehensive test ì‹¤í–‰
- [ ] Balanced test ì‹¤í–‰
- [ ] ì—ëŸ¬ ì—†ì´ ì™„ë£Œ

### Phase 5
- [ ] Deep quality assessment
- [ ] ë¹„êµ ë¶„ì„ ì™„ë£Œ
- [ ] ëª©í‘œ ë‹¬ì„± ì—¬ë¶€ íŒë‹¨

### ì¢…ë£Œ
- [ ] Day 2 ë³´ê³ ì„œ ì‘ì„±
- [ ] Week 1 ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
- [ ] ë‹¤ìŒ ë‹¨ê³„ ê³„íš

---

**ì‘ì„±ì¼**: 2025-11-11
**ì‘ì„±ì**: Claude Code
**ìƒíƒœ**: ì‹¤í–‰ ì¤€ë¹„ ì™„ë£Œ âœ…
