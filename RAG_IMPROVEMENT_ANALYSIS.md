# RAG ì‹œìŠ¤í…œ ì „ì²´ ë§¥ë½ ì´í•´ ê°œì„  ë°©ì•ˆ ë¶„ì„

## ğŸ” í˜„ì¬ ì‹œìŠ¤í…œ ë¶„ì„

### í˜„ì¬ êµ¬í˜„ëœ ê¸°ëŠ¥
```
âœ… Hybrid Search (ë²¡í„° + BM25)
âœ… Korean Reranker (MRR 0.87)
âœ… Small-to-Large ì•„í‚¤í…ì²˜
âœ… Query Expansion (ë™ì˜ì–´ + Multi-Query)
âœ… Entity Boost
âœ… ì¿¼ë¦¬ íƒ€ì…ë³„ í”„ë¡¬í”„íŠ¸
âœ… ë‹µë³€ ê²€ì¦ ë° ì¬ìƒì„±
```

### ë¬¸ì œì : ì „ì²´ ë§¥ë½ íŒŒì•… ë¶€ì¡±

#### í˜„ì¬ ì„¤ì •ì˜ í•œê³„
```json
{
  "chunk_size": 1000,        // ì²­í¬ê°€ ì‘ì•„ì„œ ì „ì²´ ë§¥ë½ ì†ì‹¤
  "chunk_overlap": 200,      // ì˜¤ë²„ë© ë¶€ì¡±
  "top_k": 3,                // ì ì€ ê²€ìƒ‰ ê²°ê³¼
  "reranker_initial_k": 20,  // í›„ë³´ ë¶€ì¡±
  "reranker_top_k": 3        // ìµœì¢… ê²°ê³¼ê°€ ë„ˆë¬´ ì ìŒ
}
```

#### ê·¼ë³¸ ì›ì¸
1. **ì²­í¬ í¬ê¸°**: 1000ìëŠ” ë¬¸ì„œ ì „ì²´ ë§¥ë½ íŒŒì•…ì— ë¶€ì¡±
2. **ê²€ìƒ‰ ê²°ê³¼**: Top 3ê°œë§Œ ì‚¬ìš© â†’ ë‹¨í¸ì  ì •ë³´
3. **ë¬¸ì„œ ë¶„ì‚°**: ê´€ë ¨ ì •ë³´ê°€ ì—¬ëŸ¬ ì²­í¬/ë¬¸ì„œì— í©ì–´ì ¸ ìˆìŒ
4. **ë‹¨ì¼ Round ê²€ìƒ‰**: í•œ ë²ˆì˜ ê²€ìƒ‰ìœ¼ë¡œë§Œ ë‹µë³€ ìƒì„±

## ğŸ’¡ ê°œì„  ë°©ì•ˆ ë¹„êµ

### Option 1: íŒŒë¼ë¯¸í„° ìµœì í™” (ì €ë¹„ìš©, ë¹ ë¥¸ ì ìš©)

#### 1-1. ì²­í¬ í¬ê¸° ë° ê²€ìƒ‰ ë²”ìœ„ í™•ëŒ€
```json
{
  "chunk_size": 1500,              // 1000 â†’ 1500 (+50%)
  "chunk_overlap": 400,            // 200 â†’ 400 (+100%)
  "top_k": 5,                      // 3 â†’ 5 (+67%)
  "reranker_initial_k": 40,        // 20 â†’ 40 (+100%)
  "reranker_top_k": 5              // 3 â†’ 5 (+67%)
}
```

**ì˜ˆìƒ íš¨ê³¼**: â­â­â­
- **ì¥ì **: ì¦‰ì‹œ ì ìš© ê°€ëŠ¥, ì½”ë“œ ë³€ê²½ ìµœì†Œ
- **ë‹¨ì **: ë©”ëª¨ë¦¬/ì²˜ë¦¬ ì‹œê°„ ì¦ê°€, ê·¼ë³¸ í•´ê²° ì•„ë‹˜
- **ê°œì„ ë„**: 10-15% í–¥ìƒ ì˜ˆìƒ

#### 1-2. ì„ë² ë”© ëª¨ë¸ ì—…ê·¸ë ˆì´ë“œ
**í˜„ì¬**: `mxbai-embed-large:latest` (1024ì°¨ì›)

**ëŒ€ì•ˆ ëª¨ë¸**:
- **BGE-M3**: Multilingual, 1024ì°¨ì›, í•œêµ­ì–´ ìµœì í™”
- **Jina Embeddings v3**: 1024-8192ì°¨ì›, ë‹¤êµ­ì–´
- **Keep It Private v1.5**: 768ì°¨ì›, í•œêµ­ì–´ íŠ¹í™”

**ì˜ˆìƒ íš¨ê³¼**: â­â­â­â­
- **ì¥ì **: ê²€ìƒ‰ ì •í™•ë„ í–¥ìƒ, ì¶”ê°€ ì½”ë“œ ë¶ˆí•„ìš”
- **ë‹¨ì **: ëª¨ë¸ ë‹¤ìš´ë¡œë“œ/ì „í™˜ í•„ìš”
- **ê°œì„ ë„**: 15-25% í–¥ìƒ ì˜ˆìƒ

### Option 2: ì•Œê³ ë¦¬ì¦˜ ê°œì„  (ì¤‘ê°„ ë¹„ìš©)

#### 2-1. Adaptive Context Retrieval ì¶”ê°€
```python
# í˜„ì¬ëŠ” ê³ ì •ëœ top_k ì‚¬ìš©
# ê°œì„ : ì§ˆë¬¸ ë³µì¡ë„ì— ë”°ë¼ ë™ì  ì¡°ì •

def adaptive_search(question, complexity_score):
    if complexity_score > 0.8:
        top_k = 10  # ë³µì¡í•œ ì§ˆë¬¸
    elif complexity_score > 0.5:
        top_k = 7
    else:
        top_k = 5
```

**ì˜ˆìƒ íš¨ê³¼**: â­â­â­
- **ì¥ì **: ìƒí™©ë³„ ìµœì í™”
- **ë‹¨ì **: ë³µì¡ë„ ì¸¡ì • ë¡œì§ í•„ìš”
- **ê°œì„ ë„**: 10-20% í–¥ìƒ ì˜ˆìƒ

#### 2-2. Multi-Round Retrieval ë„ì…
```python
# Round 1: ì´ˆê¸° ê²€ìƒ‰
results_1 = search(query)

# Round 2: ëˆ„ë½ëœ ì •ë³´ ë³´ì¶© ê²€ìƒ‰
missing_keywords = identify_gaps(query, results_1)
query_2 = expand_query(query, missing_keywords)
results_2 = search(query_2)

# ê²°í•© ë° ì¤‘ë³µ ì œê±°
final_results = merge_and_dedup(results_1, results_2)
```

**ì˜ˆìƒ íš¨ê³¼**: â­â­â­â­
- **ì¥ì **: ì „ì²´ ë§¥ë½ ì»¤ë²„, ëˆ„ë½ ì •ë³´ ìµœì†Œí™”
- **ë‹¨ì **: ì‘ë‹µ ì‹œê°„ ì¦ê°€, êµ¬í˜„ ë³µì¡ë„ ì¦ê°€
- **ê°œìƒë„**: 25-40% í–¥ìƒ ì˜ˆìƒ

#### 2-3. Context Window í™•ì¥ (LLM ì§€ì› ì‹œ)
```json
{
  "enable_long_context": true,
  "context_window_expansion": true,
  "max_context_tokens": 8000  // ê¸°ë³¸ ëŒ€ë¹„ 2-3ë°° ì¦ê°€
}
```

**ì˜ˆìƒ íš¨ê³¼**: â­â­â­â­â­
- **ì¥ì **: ëŒ€ê·œëª¨ ì»¨í…ìŠ¤íŠ¸ ì²˜ë¦¬, ì „ì²´ ë§¥ë½ í¬í•¨
- **ë‹¨ì **: LLM í† í° ì œí•œ, ì²˜ë¦¬ ì‹œê°„ ì¦ê°€
- **ê°œìƒë„**: 30-50% í–¥ìƒ ì˜ˆìƒ

### Option 3: LangGraph ì—…ê·¸ë ˆì´ë“œ (ê³ ë¹„ìš©, ê³ íš¨ê³¼)

#### 3-1. LangGraph ì†Œê°œ
**LangGraph**ëŠ” LangChainì˜ ê·¸ë˜í”„ ê¸°ë°˜ ì›Œí¬í”Œë¡œìš° í”„ë ˆì„ì›Œí¬ë¡œ, ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë¥¼ ì œê³µ:

```python
# Agentic RAG Architecture
State â†’ Retrieve â†’ Grade â†’ Transform â†’ Generate â†’ (Loop)

# Self-Reflection & Conditional Paths
if confidence < 0.7:
    â†’ Retrieve additional docs
if answer_quality < threshold:
    â†’ Regenerate with different strategy
```

#### 3-2. LangGraphì˜ í•µì‹¬ ê¸°ëŠ¥
1. **ë‹¤ë‹¨ê³„ ê²€ìƒ‰**: Round-robin retrieval with quality checks
2. **ìƒíƒœ ê´€ë¦¬**: ëŒ€í™” íˆìŠ¤í† ë¦¬ + ê²€ìƒ‰ ìƒíƒœ ìœ ì§€
3. **ì¡°ê±´ë¶€ ë¶„ê¸°**: ê²€ìƒ‰ í’ˆì§ˆì— ë”°ë¥¸ ë™ì  ë¼ìš°íŒ…
4. **Self-reflection**: ë‹µë³€ í’ˆì§ˆ ìê°€ í‰ê°€ ë° ì¬ê²€ìƒ‰

**ì˜ˆìƒ íš¨ê³¼**: â­â­â­â­â­
- **ì¥ì **: ì „ì²´ ë§¥ë½ íŒŒì•… ìµœì , ë³µì¡ ì§ˆë¬¸ ì²˜ë¦¬
- **ë‹¨ì **: êµ¬í˜„ ë³µì¡, í•™ìŠµ ê³¡ì„ , ë””ë²„ê¹… ì–´ë ¤ì›€
- **ê°œìƒë„**: 40-70% í–¥ìƒ ì˜ˆìƒ

## ğŸ“Š ì„±ëŠ¥ ë¹„êµ ì˜ˆì¸¡

### í˜„ì¬ vs ê°œì„ ì•ˆ

| ë°©ë²• | êµ¬í˜„ ë‚œì´ë„ | ë¹„ìš© | ì˜ˆìƒ ê°œì„ ë„ | ì ìš© ì‹œê°„ |
|------|------------|------|------------|----------|
| **íŒŒë¼ë¯¸í„° ìµœì í™”** | â­ | ë‚®ìŒ | 10-15% | ì¦‰ì‹œ |
| **ì„ë² ë”© ì—…ê·¸ë ˆì´ë“œ** | â­â­ | ë‚®ìŒ | 15-25% | 1ì¼ |
| **Adaptive Context** | â­â­â­ | ì¤‘ê°„ | 10-20% | 2-3ì¼ |
| **Multi-Round Retrieval** | â­â­â­â­ | ì¤‘ê°„ | 25-40% | 1ì£¼ |
| **Context Window í™•ì¥** | â­â­â­ | ì¤‘ê°„ | 30-50% | 3ì¼ |
| **LangGraph ì—…ê·¸ë ˆì´ë“œ** | â­â­â­â­â­ | ë†’ìŒ | 40-70% | 2-3ì£¼ |

### ë³µí•© ì ìš© ì „ëµ

#### ğŸ¯ **Phase 1: Quick Wins (1ì£¼)**
```json
{
  "chunk_size": 1500,
  "chunk_overlap": 400,
  "top_k": 5,
  "reranker_initial_k": 40,
  "reranker_top_k": 5
}
```
+ ì„ë² ë”© ëª¨ë¸ ì—…ê·¸ë ˆì´ë“œ (BGE-M3 or Jina v3)

**ì˜ˆìƒ ê°œì„ **: 25-40%

#### ğŸ¯ **Phase 2: Algorithm Enhancement (2ì£¼)**
- Multi-Round Retrieval ì¶”ê°€
- Adaptive Context Retrieval êµ¬í˜„
- LLM Context Window í™•ì¥

**ì˜ˆìƒ ê°œì„ **: +15-30%

#### ğŸ¯ **Phase 3: LangGraph (ì„ íƒ, 3ì£¼)**
- Agentic RAG ì•„í‚¤í…ì²˜
- Self-Reflection & Grading
- ì¡°ê±´ë¶€ ê²€ìƒ‰ í™•ì¥

**ì˜ˆìƒ ê°œì„ **: +20-40%

## ğŸš€ ê¶Œì¥ ì ìš© ìˆœì„œ

### ì¦‰ì‹œ ì ìš© ê°€ëŠ¥ (Config ìˆ˜ì •ë§Œ)

#### 1ë‹¨ê³„: íŒŒë¼ë¯¸í„° ìµœì í™”
```json
{
  "chunk_size": 1500,
  "chunk_overlap": 400,
  "top_k": 5,
  "reranker_initial_k": 40,
  "reranker_top_k": 5
}
```

**ì´ìœ **:
- ì½”ë“œ ë³€ê²½ ì—†ìŒ
- ì¦‰ì‹œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- íš¨ê³¼ ì¦‰ê°ì 

#### 2ë‹¨ê³„: ì„ë² ë”© ëª¨ë¸ ê³ ë ¤
**í›„ë³´**:
- **BGE-M3**: í•œêµ­ì–´ ìµœì í™”, ë¬´ë£Œ
- **Jina v3**: ë‹¤êµ­ì–´, ê³ ì„±ëŠ¥, API ì œê³µ

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] Ollamaì— ëª¨ë¸ ì¶”ê°€ ê°€ëŠ¥í•œì§€
- [ ] ë²¡í„° DB ì¬ì¸ë±ì‹± í•„ìš”
- [ ] í˜¸í™˜ì„± ê²€ì¦

### ì¤‘ê¸° ê°œì„  (ì•Œê³ ë¦¬ì¦˜ ì¶”ê°€)

#### 3ë‹¨ê³„: Multi-Round Retrieval
**êµ¬í˜„ ê³„íš**:
```python
def enhanced_search(query, initial_results):
    # Round 1: ê¸°ë³¸ ê²€ìƒ‰
    r1 = search(query)
    
    # ë¹ˆ ë¶„ì„
    missing = analyze_gaps(query, r1)
    
    # Round 2: ë³´ì¶© ê²€ìƒ‰
    if missing:
        r2 = search(expand_query(query, missing))
        return merge(r1, r2)
    
    return r1
```

**ìš°ì„ ìˆœìœ„**: ë†’ìŒ â­â­â­â­â­

#### 4ë‹¨ê³„: Context Window í™•ì¥
**ì¡°ê±´**: LLMì´ í° ì»¨í…ìŠ¤íŠ¸ ì§€ì› ì‹œ
- GPT-4: 128K í† í° âœ…
- Ollama (ëŒ€ë¶€ë¶„): 32K-128K âœ…
- API ì œí•œ í™•ì¸ í•„ìš”

### ì¥ê¸° ê³ ë ¤ (LangGraph)

#### 5ë‹¨ê³„: LangGraph ë„ì… (ì„ íƒì )
**ê²°ì • ê¸°ì¤€**:
- Phase 1-4 ì ìš© í›„ì—ë„ ë§Œì¡± ëª»í•  ë•Œ
- ë³µì¡í•œ ì§ˆë¬¸ ì²˜ë¦¬ê°€ í•„ìˆ˜ì¼ ë•Œ
- ì‹œê°„/ë¦¬ì†ŒìŠ¤ ì—¬ìœ  ìˆì„ ë•Œ

## ğŸ¬ ì¦‰ì‹œ ì ìš© ì œì•ˆ

### ìµœì†Œ ë³€ê²½, ìµœëŒ€ íš¨ê³¼ ì¡°í•©

```json
{
  "chunk_size": 1500,              // +50%
  "chunk_overlap": 400,            // +100%
  "top_k": 5,                      // +67%
  "reranker_initial_k": 40,        // +100%
  "reranker_top_k": 5,             // +67%
  "temperature": 0.5,              // 0.7 â†’ 0.5 (ì¼ê´€ì„± í–¥ìƒ)
  
  "enable_adaptive_context": true,
  "min_context_documents": 3,
  "max_context_documents": 8,
  
  "enable_multi_round": true,
  "max_search_rounds": 2
}
```

**ì˜ˆìƒ íš¨ê³¼**: ì „ì²´ 30-50% ê°œì„ 

---

## ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„

1. **íŒŒë¼ë¯¸í„° ìµœì í™”**: config.json ìˆ˜ì •ë§Œìœ¼ë¡œ ì¦‰ì‹œ ì ìš©
2. **ì„±ëŠ¥ í…ŒìŠ¤íŠ¸**: ê°œì„ ë„ ì¸¡ì •
3. **ë‹¨ê³„ë³„ ì ìš©**: íš¨ê³¼ê°€ ìˆì„ ì‹œ ë” ê³ ê¸‰ ê¸°ë²• ì¶”ê°€
4. **LangGraph ê²€í† **: í•„ìš” ì‹œ 1-2ê°œì›” í›„

**ê²°ë¡ **: íŒŒë¼ë¯¸í„° ìµœì í™”ë¶€í„° ì‹œì‘í•˜ì—¬ ì ì§„ì ìœ¼ë¡œ ê°œì„ í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.

