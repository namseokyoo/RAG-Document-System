# RAG ì‹œìŠ¤í…œ ê°œì„  í”Œëœ
## í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„ì„ ë° ê°œì„  ë°©ì•ˆ (2024-10-28)

### ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½
- **í…ŒìŠ¤íŠ¸ ì§ˆë¬¸ ìˆ˜**: 15ê°œ
- **í‰ê·  í’ˆì§ˆ ì ìˆ˜**: 1.53/4.0 (38%)
- **í‰ê·  ì‘ë‹µ ì‹œê°„**: 15.24ì´ˆ
- **ì¶œì²˜ ë°˜í™˜ë¥ **: 0% (0/15) âš ï¸ **ì‹¬ê°í•œ ë¬¸ì œ**
- **í’ˆì§ˆ ì ìˆ˜ 1ì  ì´í•˜**: 7ê°œ ì§ˆë¬¸ (47%)

---

## ğŸ”´ ì‹¬ê°í•œ ë¬¸ì œì  (Critical Issues)

### 1. ì¶œì²˜ ë°˜í™˜ ì‹¤íŒ¨ (Sources Not Returned)
**ì¦ìƒ**: ëª¨ë“  ì§ˆë¬¸ì—ì„œ `sources_count: 0`

**ì›ì¸ ë¶„ì„**:
1. `get_source_documents()` ë©”ì„œë“œê°€ ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
2. `_last_retrieved_docs` ìºì‹œê°€ ì œëŒ€ë¡œ ì—…ë°ì´íŠ¸ë˜ì§€ ì•ŠìŒ
3. `query()` ë©”ì„œë“œì™€ RAG chainì˜ ë¶ˆì¼ì¹˜

**í•´ê²° ë°©ì•ˆ**:
```python
# utils/rag_chain.py ìˆ˜ì •
def query(self, question: str, chat_history: List[Dict[str, str]] = None) -> Dict[str, Any]:
    try:
        formatted_history = self._format_chat_history(chat_history or [])
        
        # ì»¨í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸° (ì´ë¯¸ _last_retrieved_docs ìºì‹œë¨)
        context = self._get_context(question)
        
        answer = self.chain.invoke({
            "question": question,
            "chat_history": formatted_history
        })
        
        # ìºì‹œëœ ë¬¸ì„œ ì‚¬ìš©
        sources = self.get_source_documents(question)
        
        return {
            "answer": answer,
            "sources": sources,
            "context_length": len(context)
        }
```

### 2. ê²€ìƒ‰ ê²°ê³¼ ë¶€ì¡±
**ì¦ìƒ**: ë‹µë³€ì—ì„œ "ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ë‹¤"ëŠ” ë©”ì‹œì§€ ì§€ì†

**ì›ì¸ ë¶„ì„**:
1. `reranker_initial_k`ê°€ 20ìœ¼ë¡œ ë„ˆë¬´ ì‘ìŒ
2. ì„ê³„ê°’ í•„í„°ë§ìœ¼ë¡œ ìœ íš¨í•œ ë¬¸ì„œê°€ ì œì™¸ë¨
3. ë‹¤êµ­ì–´ ê²€ìƒ‰ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•ŠìŒ

**í•´ê²° ë°©ì•ˆ**:
```json
// config.json ìˆ˜ì •
{
  "reranker_initial_k": 60,  // 20 â†’ 60
  "top_k": 10,  // 20 â†’ 10 (ë„ˆë¬´ í¬ë©´ ë…¸ì´ì¦ˆ)
}
```

### 3. Page Summary ì¡°íšŒ ì‹¤íŒ¨
**ì¦ìƒ**: `Expected include item to be one of documents, embeddings...`

**ì›ì¸**: ChromaDB API í˜¸ì¶œ í˜•ì‹ ì˜¤ë¥˜

**í•´ê²° ë°©ì•ˆ**:
```python
# utils/rag_chain.py - _get_context_for_summarization ìˆ˜ì •
all_data = collection.get(
    where={"chunk_type": "page_summary"},
    include=["documents", "metadatas"]  # "ids" ì œê±°
)
```

---

## ğŸŸ¡ ì¤‘ê°„ ìš°ì„ ìˆœìœ„ ë¬¸ì œ

### 4. ìš”ì•½ í’ˆì§ˆ ê°œì„ 
**í˜„ì¬**: í‰ê·  2.0/4.0
**ê°œì„  ëª©í‘œ**: 3.0/4.0

**ê°œì„  ë°©ì•ˆ**:
1. ìš”ì•½ ì „ìš© í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì¶”ê°€
2. êµ¬ì¡°í™”ëœ ìš”ì•½ í˜•ì‹ ì ìš©:
   - ì—°êµ¬ ëª©ì 
   - í•µì‹¬ ë°œê²¬ì‚¬í•­
   - ì‹¤í—˜ ë°©ë²• ìš”ì•½
   - ê²°ë¡ 

### 5. ë³µí•© ì§ˆë¬¸ ì²˜ë¦¬ ê°œì„ 
**ì˜ˆì‹œ**: "HF ì„±ëŠ¥ì€ TADF ì¬ë£Œì— ë”°ë¼ ì–´ë–¤ ê²½í–¥ì„±ì´ìˆì–´?"
**í˜„ì¬ í’ˆì§ˆ**: 1.0/4.0

**ê°œì„  ë°©ì•ˆ**:
1. ì§ˆë¬¸ ìœ í˜• ê°ì§€ (ë¹„êµ, ë¶„ì„, ìš”ì•½ ë“±)
2. ê´€ê³„í˜• ì§ˆë¬¸ì€ ì—¬ëŸ¬ ì²­í¬ ìˆ˜ì§‘ ê°•í™”
3. ë¹„êµ ë¶„ì„ ì „ìš© í”„ë¡¬í”„íŠ¸ ì¶”ê°€

### 6. ì‘ë‹µ ì‹œê°„ ìµœì í™”
**í˜„ì¬**: 15.24ì´ˆ (ëª©í‘œ: <10ì´ˆ)

**ê°œì„  ë°©ì•ˆ**:
1. ë¶ˆí•„ìš”í•œ LLM í˜¸ì¶œ ì œê±° (ë²ˆì—­, ì¬ì‘ì„± ë“±)
2. ìºì‹± ì¶”ê°€
3. ë³‘ë ¬ ê²€ìƒ‰ ìµœì í™”

---

## ğŸŸ¢ ë‚®ì€ ìš°ì„ ìˆœìœ„ (Nice to Have)

### 7. ë‹¤êµ­ì–´ ê²€ìƒ‰ ê°•í™”
- ì¿¼ë¦¬ ë²ˆì—­ í’ˆì§ˆ í–¥ìƒ
- ì˜ì–´ ë™ì˜ì–´ í™•ì¥ ê°œì„ 

### 8. ì‹œê°í™” ë°ì´í„° ê²€ìƒ‰
- ê·¸ë˜í”„/í‘œ ìº¡ì…˜ ì¸ì‹
- ìˆ˜ì¹˜ ë°ì´í„° ì¶”ì¶œ

---

## ğŸ“‹ ê°œì„  ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: ê¸´ê¸‰ ìˆ˜ì • (ì¦‰ì‹œ)
- [ ] `get_source_documents()` ë©”ì„œë“œ ìˆ˜ì •
- [ ] `query()` ë©”ì„œë“œì—ì„œ ì†ŒìŠ¤ ë°˜í™˜ ë³´ì¥
- [ ] Page summary ì¡°íšŒ ì˜¤ë¥˜ ìˆ˜ì •
- [ ] `reranker_initial_k` ì¦ê°€ (20 â†’ 60)

### Phase 2: ê²€ìƒ‰ í’ˆì§ˆ ê°œì„  (1ì£¼ì¼)
- [ ] í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ê°€ì¤‘ì¹˜ ì¡°ì •
- [ ] ì„ê³„ê°’ í•„í„°ë§ ì™„í™”
- [ ] ë‹¤êµ­ì–´ ê²€ìƒ‰ ë””ë²„ê¹…
- [ ] ìš”ì•½ í”„ë¡¬í”„íŠ¸ ê°œì„ 

### Phase 3: ì„±ëŠ¥ ìµœì í™” (2ì£¼ì¼)
- [ ] ì‘ë‹µ ì‹œê°„ ìµœì í™”
- [ ] ìºì‹± ì‹œìŠ¤í…œ ì¶”ê°€
- [ ] ë¶ˆí•„ìš”í•œ LLM í˜¸ì¶œ ì œê±°

### Phase 4: ê³ ê¸‰ ê¸°ëŠ¥ (1ê°œì›”)
- [ ] ì§ˆë¬¸ ìœ í˜• ê°ì§€
- [ ] ê´€ê³„í˜• ì§ˆë¬¸ ì²˜ë¦¬
- [ ] ë¹„êµ ë¶„ì„ í”„ë¡¬í”„íŠ¸

---

## ğŸ¯ ëª©í‘œ ì§€í‘œ

| ì§€í‘œ | í˜„ì¬ | ëª©í‘œ (1ì£¼ì¼) | ëª©í‘œ (1ê°œì›”) |
|------|------|------------|------------|
| í‰ê·  í’ˆì§ˆ ì ìˆ˜ | 1.53/4.0 | 2.5/4.0 | 3.0/4.0 |
| ì¶œì²˜ ë°˜í™˜ë¥  | 0% | 80% | 95% |
| í‰ê·  ì‘ë‹µ ì‹œê°„ | 15.24ì´ˆ | 12ì´ˆ | 8ì´ˆ |
| í’ˆì§ˆ 1ì  ì´í•˜ ë¹„ìœ¨ | 47% | 20% | <10% |

---

## ğŸ“ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ìš°ì„ ìˆœìœ„

1. **TADF ì¬ë£Œ ê²€ìƒ‰** (í˜„ì¬ 1ì ) - ê°€ì¥ ì¤‘ìš”
2. **HF ì„±ëŠ¥ ê²½í–¥ì„± ë¶„ì„** (í˜„ì¬ 1ì ) - ê´€ê³„ ë¶„ì„ í…ŒìŠ¤íŠ¸
3. **ë…¼ë¬¸ ìš”ì•½** (í˜„ì¬ 2ì ) - ìš”ì•½ í’ˆì§ˆ í…ŒìŠ¤íŠ¸
4. **ì‹¤í—˜ ë°©ë²•ë¡ ** (í˜„ì¬ 1ì ) - êµ¬ì²´ì  ì •ë³´ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸

